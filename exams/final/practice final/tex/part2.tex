% This file was automatically created from the m-file 
% "m2tex.m" written by USL. 
% The fontencoding in this file is UTF-8. 
%  
% You will need to include the following two packages in 
% your LaTeX-Main-File. 
%  
% \usepackage{color} 
% \usepackage{fancyvrb} 
%  
% It is advised to use the following option for Inputenc 
% \usepackage[utf8]{inputenc} 
%  
  
% definition of matlab colors: 
\definecolor{mblue}{rgb}{0,0,1} 
\definecolor{mgreen}{rgb}{0.13333,0.5451,0.13333} 
\definecolor{mred}{rgb}{0.62745,0.12549,0.94118} 
\definecolor{mgrey}{rgb}{0.5,0.5,0.5} 
\definecolor{mdarkgrey}{rgb}{0.25,0.25,0.25} 
  
\DefineShortVerb[fontfamily=courier,fontseries=m]{\$} 
\DefineShortVerb[fontfamily=courier,fontseries=b]{\#} 
  
\noindent                                                                                       \hspace*{-1.6em}{\scriptsize 1}$  $\color{mgrey}#%% Part 2: Modeling nonlinear plant with nonlinear adaptive filter#\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 2}$  Niterations = 2000;             $\color{mgrey}$% Number of iterations$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 3}$  Nruns = 100;                    $\color{mgrey}$% Number of runs to average MSE$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 4}$  L = 9;                          $\color{mgrey}$% filter length - 1$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 5}$  var_r = 4;                      $\color{mgrey}$% variance of input signal$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 6}$  mu = 4e-4;                      $\color{mgrey}$% adaptation constant$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 7}$  xtest = 2*cos(pi/10*(0:50));    $\color{mgrey}$% test signal$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 8}$  ytest = nonlinear_plant(xtest); $\color{mgrey}$% nonlinear plant output for test signal$\color{black}$$\\ \hspace*{-1.6em}{\scriptsize 9}$  Nweights = 2*(L+1) + nchoosek(L+1, 2) + 1; $\color{mgrey}$% Number of weights$\color{black}$$\\ \hspace*{-2em}{\scriptsize 10}$  $\\ \hspace*{-2em}{\scriptsize 11}$  $\color{mgrey}$% For part 2.E$\color{black}$$\\ \hspace*{-2em}{\scriptsize 12}$  $\color{mgrey}$% var_r = 0.4;$\color{black}$$\\ \hspace*{-2em}{\scriptsize 13}$  $\color{mgrey}$% mu = 4e-3;$\color{black}$$\\ \hspace*{-2em}{\scriptsize 14}$  $\\ \hspace*{-2em}{\scriptsize 15}$  $\color{mgrey}$% Indices for cross-products $\color{black}$$\\ \hspace*{-2em}{\scriptsize 16}$  idx = nchoosek(1:L+1, 2);       $\\ \hspace*{-2em}{\scriptsize 17}$  $\\ \hspace*{-2em}{\scriptsize 18}$  MSE = zeros(Niterations, Nruns);$\\ \hspace*{-2em}{\scriptsize 19}$  $#for#$ run = 1:Nruns$\\ \hspace*{-2em}{\scriptsize 20}$      $\color{mgrey}$% Input signal: white and uniformly distributed zero-mean noise with$\color{black}$$\\ \hspace*{-2em}{\scriptsize 21}$      $\color{mgrey}$% var_r variance$\color{black}$$\\ \hspace*{-2em}{\scriptsize 22}$      r = sqrt(var_r*12)*(rand(Niterations, 1)-0.5); $\\ \hspace*{-2em}{\scriptsize 23}$  $\\ \hspace*{-2em}{\scriptsize 24}$      d = nonlinear_plant(r); $\color{mgrey}$% calculate desired response$\color{black}$$\\ \hspace*{-2em}{\scriptsize 25}$      $\\ \hspace*{-2em}{\scriptsize 26}$      $\color{mgrey}$% Reset weights, input, and error before running LMS$\color{black}$$\\ \hspace*{-2em}{\scriptsize 27}$      W = zeros(Nweights, 1); $\color{mgrey}$% weight vector$\color{black}$$\\ \hspace*{-2em}{\scriptsize 28}$      X = zeros(L+1, 1); $\color{mgrey}$% shift register$\color{black}$$\\ \hspace*{-2em}{\scriptsize 29}$      error = zeros(Niterations, 1);$\\ \hspace*{-2em}{\scriptsize 30}$      $#for#$ k = 1:Niterations$\\ \hspace*{-2em}{\scriptsize 31}$          X = [r(k); X(1:end-1)];                 $\color{mgrey}$% tap delay line$\color{black}$$\\ \hspace*{-2em}{\scriptsize 32}$          X2 = X.^2;                              $\color{mgrey}$% squared inputs $\color{black}$$\\ \hspace*{-2em}{\scriptsize 33}$          Xprod  = X(idx(:, 1)).*X(idx(:, 2));    $\color{mgrey}$% cross-products$\color{black}$$\\ \hspace*{-2em}{\scriptsize 34}$          Xin = [1; X; X2; Xprod];                $\color{mgrey}$% build input to adaptive filter$\color{black}$$\\ \hspace*{-2em}{\scriptsize 35}$          y = W.'*Xin;                            $\color{mgrey}$% calculate output$\color{black}$$\\ \hspace*{-2em}{\scriptsize 36}$          error(k) = d(k) - y;                    $\color{mgrey}$% calculate error$\color{black}$$\\ \hspace*{-2em}{\scriptsize 37}$          W = W + 2*mu*error(k)*Xin;              $\color{mgrey}$% weights update$\color{black}$$\\ \hspace*{-2em}{\scriptsize 38}$      $#end#$$\\ \hspace*{-2em}{\scriptsize 39}$      MSE(:, $\color{mdarkgrey}$run) = error.^2;$\color{black}$$\\ \hspace*{-2em}{\scriptsize 40}$  $#end#$$\\ \hspace*{-2em}{\scriptsize 41}$  $\\ \hspace*{-2em}{\scriptsize 42}$  MSE = mean(MSE, 2); $\color{mgrey}$% average MSE over the number of runs$\color{black}$$\\ \hspace*{-2em}{\scriptsize 43}$  MMSE = mean(MSE(end-199:end)); $\color{mgrey}$% use last 200 samples to estimate MMSE$\color{black}$$\\ \hspace*{-2em}{\scriptsize 44}$  $\\ \hspace*{-2em}{\scriptsize 45}$  $\color{mgrey}$% Calculate model output for test signal$\color{black}$$\\ \hspace*{-2em}{\scriptsize 46}$  ymodel = zeros(size(xtest));$\\ \hspace*{-2em}{\scriptsize 47}$  $#for#$ k = 1:length(xtest)$\\ \hspace*{-2em}{\scriptsize 48}$      X = [xtest(k); X(1:end-1)];$\\ \hspace*{-2em}{\scriptsize 49}$      X2 = X.^2;$\\ \hspace*{-2em}{\scriptsize 50}$      Xprod  = X(idx(:, 1)).*X(idx(:, 2));$\\ \hspace*{-2em}{\scriptsize 51}$      Xin = [1; X; X2; Xprod];$\\ \hspace*{-2em}{\scriptsize 52}$      ymodel(k) = W.'*Xin;$\\ \hspace*{-2em}{\scriptsize 53}$  $#end#$$\\ \hspace*{-2em}{\scriptsize 54}$  $\\ \hspace*{-2em}{\scriptsize 55}$  $\color{mgrey}#%% Plots#\color{black}$$\\ \hspace*{-2em}{\scriptsize 56}$  $\color{mgrey}$% Learning curve$\color{black}$$\\ \hspace*{-2em}{\scriptsize 57}$  figure, $\color{mdarkgrey}$hold on, box on$\color{black}$$\\ \hspace*{-2em}{\scriptsize 58}$  plot(MSE(Nweights+1:end, $\color{mdarkgrey}$:))$\color{black}$$\\ \hspace*{-2em}{\scriptsize 59}$  plot([1 Niterations], MMSE*[1 1], $\color{mdarkgrey}$'--r'$\color{black}$)$\\ \hspace*{-2em}{\scriptsize 60}$  xlabel($\color{mdarkgrey}$'k'$\color{black}$, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 61}$  ylabel($\color{mdarkgrey}$'MSE'$\color{black}$, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 62}$  set(gca, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 63}$  legend($\color{mdarkgrey}$'Experimental learning curve'$\color{black}$, sprintf($\color{mdarkgrey}$'Estimated MMSE = %G'$\color{black}$, MMSE))$\\ \hspace*{-2em}{\scriptsize 64}$  saveas(gca, $\color{mdarkgrey}$'figs/part2_learning_curve'$\color{black}$, $\color{mdarkgrey}$'epsc'$\color{black}$)$\\ \hspace*{-2em}{\scriptsize 65}$  $\\ \hspace*{-2em}{\scriptsize 66}$  $\color{mgrey}$% Weights$\color{black}$$\\ \hspace*{-2em}{\scriptsize 67}$  figure, $\color{mdarkgrey}$hold on, box on$\color{black}$$\\ \hspace*{-2em}{\scriptsize 68}$  stem(0:Nweights-1, W, $\color{mdarkgrey}$'fill'$\color{black}$)$\\ \hspace*{-2em}{\scriptsize 69}$  xlabel($\color{mdarkgrey}$'index'$\color{black}$, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 70}$  ylabel($\color{mdarkgrey}$'Weight'$\color{black}$, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 71}$  set(gca, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 72}$  axis([0 $\color{mdarkgrey}$Nweights-1 -0.05 0.25])$\color{black}$$\\ \hspace*{-2em}{\scriptsize 73}$  saveas(gca, $\color{mdarkgrey}$'figs/part2_weights'$\color{black}$, $\color{mdarkgrey}$'epsc'$\color{black}$)$\\ \hspace*{-2em}{\scriptsize 74}$  $\\ \hspace*{-2em}{\scriptsize 75}$  $\color{mgrey}$% Test signal$\color{black}$$\\ \hspace*{-2em}{\scriptsize 76}$  figure, $\color{mdarkgrey}$hold on, box on$\color{black}$$\\ \hspace*{-2em}{\scriptsize 77}$  t = 0:50;$\\ \hspace*{-2em}{\scriptsize 78}$  plot(t, xtest, $\color{mdarkgrey}$':k'$\color{black}$, $\color{mdarkgrey}$'LineWidth'$\color{black}$, 2)$\\ \hspace*{-2em}{\scriptsize 79}$  plot(t, ytest, $\color{mdarkgrey}$'LineWidth'$\color{black}$, 2)$\\ \hspace*{-2em}{\scriptsize 80}$  plot(t, ymodel, $\color{mdarkgrey}$'LineWidth'$\color{black}$, 2)$\\ \hspace*{-2em}{\scriptsize 81}$  xlabel($\color{mdarkgrey}$'Time'$\color{black}$, $\color{mdarkgrey}$'FontSize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 82}$  ylabel($\color{mdarkgrey}$'Amplitude'$\color{black}$, $\color{mdarkgrey}$'FontSize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 83}$  legend($\color{mdarkgrey}$'Nonlinear plant input'$\color{black}$, $\color{mdarkgrey}$'Nonlinear plant output'$\color{black}$,...$\\ \hspace*{-2em}{\scriptsize 84}$      $\color{mdarkgrey}$'Adaptive filter output'$\color{black}$, $\color{mdarkgrey}$'Location'$\color{black}$, $\color{mdarkgrey}$'SouthEast'$\color{black}$)$\\ \hspace*{-2em}{\scriptsize 85}$  set(gca, $\color{mdarkgrey}$'Fontsize'$\color{black}$, 12)$\\ \hspace*{-2em}{\scriptsize 86}$  saveas(gca, $\color{mdarkgrey}$'figs/part2_test'$\color{black}$, $\color{mdarkgrey}$'epsc'$\color{black}$)$\\ 
  
\UndefineShortVerb{\$} 
\UndefineShortVerb{\#}